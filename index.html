<!DOCTYPE html>
<html>
<head>
    <title>Карта мусорных контейнеров Симферополя</title>
    <!-- Остальные метатеги и стили остаются без изменений -->
</head>
<body>
    <!-- HTML-структура остается без изменений -->

    <script>
        // Создаем карту с центром в Симферополе
        var map = L.map('map', {
            renderer: L.canvas(),
            preferCanvas: true,
            zoomControl: false
        }).setView([44.952116, 34.102411], 13);

        // Добавляем базовые слои
        var osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 19
        });

        var satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',
            maxZoom: 19
        });

        osmLayer.addTo(map);

        // Создаем кластеризатор
        var markers = L.markerClusterGroup({
            spiderfyOnMaxZoom: true,
            showCoverageOnHover: false,
            zoomToBoundsOnClick: true,
            disableClusteringAtZoom: 18
        });
        var markerList = [];

        // Функция для создания HTML-контента всплывающего окна (ИСПРАВЛЕНА)
        function createPopupContent(props) {
            return `
                <div class="info">
                    <h4>Контейнер №${props['№п/п']}</h4>
                    <b>Адрес:</b> ${props['Адрес']}<br>
                    <b>Площадь:</b> ${props['Площ'] || 'н/д'}<br>
                    <b>Контейнеров:</b> ${props['Контей'] || 'н/д'}<br>
                    <b>Покрытие:</b> ${props['покрыт'] || 'н/д'}<br>
                    <b>Собственник:</b> ${props['Собств'] || 'н/д'}
                </div>
            `;
        }

        // Функция для загрузки GeoJSON данных (ИСПРАВЛЕН путь к файлу)
        function loadGeoJSONData() {
            fetch('date.geojson')  // Или 'data.geojson', если вы переименовали файл
                .then(response => response.json())
                .then(data => {
                    data.features.forEach(function(feature) {
                        var props = feature.properties;
                        var lat = props['СШ'];
                        var lon = props['ВД'];
                        
                        // Создаем маркер (ИСПРАВЛЕН цвет иконки)
                        var marker = L.marker([lat, lon], {
                            icon: L.divIcon({
                                html: `<i class="fas fa-trash-alt" style="color: ${
                                    props['покрыт'] === 'Асфальт' ? 'blue' : 
                                    props['покрыт'] === 'Бетон' ? 'green' : 
                                    props['покрыт'] === 'Асфальтобетон' ? 'purple' : 'orange'
                                }; font-size: 18px;"></i>`,
                                iconSize: [18, 18],
                                className: 'my-div-icon'
                            }),
                            renderer: L.canvas()
                        }).bindPopup(createPopupContent(props));
                        
                        markers.addLayer(marker);
                        markerList.push({
                            marker: marker,
                            props: props
                        });

                        // Добавляем точку в список (ИСПРАВЛЕНЫ свойства)
                        var item = document.createElement('div');
                        item.className = 'point-item';
                        item.innerHTML = `
                            <strong>№${props['№п/п']}</strong>: ${props['Адрес']}<br>
                            <small>${props['покрыт'] || 'н/д'}, ${props['Контей'] || 'н/д'} контейнеров</small>
                        `;
                        item.onclick = function() {
                            map.setView([lat, lon], 18);
                            marker.openPopup();
                        };
                        document.getElementById('points-list').appendChild(item);
                    });

                    map.addLayer(markers);
                })
                .catch(error => {
                    console.error('Ошибка загрузки GeoJSON:', error);
                    alert('Не удалось загрузить данные о мусорных контейнерах. Проверьте имя файла и консоль для подробностей.');
                });
        }

        // Остальной код остается без изменений
        document.addEventListener('DOMContentLoaded', function() {
            loadGeoJSONData();
            setTimeout(function() {
                map.invalidateSize();
            }, 100);
        });

        // ... остальные функции (поиск, фильтрация и т.д.) остаются без изменений
    </script>
</body>
</html>